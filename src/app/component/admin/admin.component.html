<div class="admin-container">
  <div class="admin-header">
    <h1>Painel de Controle do Al√©m</h1>
    <div class="divider">
      <span class="divider-icon">‚ö°</span>
    </div>
    <p class="admin-subtitle">Gerencie os agendamentos e bloqueie datas</p>
  </div>
  
  <div *ngIf="mensagem" class="mensagem" [ngClass]="mensagemTipo">
    <div class="mensagem-icon">{{ mensagemTipo === 'sucesso' ? '‚úì' : '‚úó' }}</div>
    <div class="mensagem-texto">{{ mensagem }}</div>
  </div>
  
  <div *ngIf="carregando" class="loading">
    <div class="loading-icon"></div>
    <span>Invocando...</span>
  </div>
  
  <div class="admin-content" *ngIf="!carregando">
    <div class="admin-section bloqueio-section">
      <div class="bloqueio-container">
        <div class="bloqueio-form-container">
          <h2>Bloquear Data</h2>
          <form [formGroup]="bloqueioForm" (ngSubmit)="bloquearData()">
            <div class="form-group">
              <label for="data">Data a Bloquear</label>
              <input type="date" id="data" formControlName="data" [min]="dataHoje">
            </div>
            
            <div class="form-group">
              <label for="motivo">Motivo (opcional)</label>
              <input type="text" id="motivo" formControlName="motivo" placeholder="Ex: Feriado, Manuten√ß√£o">
            </div>
            
            <button type="submit" [disabled]="bloqueioForm.invalid">Bloquear Data</button>
          </form>
          
          <div class="datas-bloqueadas" *ngIf="datasBloqueadas.length > 0">
            <h3>Datas Bloqueadas</h3>
            <div class="datas-bloqueadas-lista">
              <div class="data-bloqueada" *ngFor="let dataBloqueada of datasBloqueadas">
                <div class="data-bloqueada-info">
                  <span class="data-bloqueada-valor">{{ formatarData(dataBloqueada.data) }}</span>
                  <span class="data-bloqueada-motivo" *ngIf="dataBloqueada.motivo">{{ dataBloqueada.motivo }}</span>
                </div>
                <button class="btn-desbloquear" (click)="desbloquearData(dataBloqueada.data)">
                  <span class="btn-icon">üîì</span> Desbloquear
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="quadro-avisos">
          <h3>Quadro de Avisos</h3>
          
          <!-- Datas Bloqueadas no Quadro de Avisos -->
          <div class="aviso datas-bloqueadas-aviso" *ngIf="datasBloqueadas.length > 0">
            <div class="aviso-icon">üö´</div>
            <div class="aviso-content">
              <h4>Datas Bloqueadas</h4>
              <div class="datas-bloqueadas-chips">
                <div class="data-bloqueada-chip-container" *ngFor="let dataBloqueada of datasBloqueadas">
                  <span class="data-bloqueada-chip">{{ formatarData(dataBloqueada.data) }}</span>
                  <span class="data-bloqueada-chip-motivo" *ngIf="dataBloqueada.motivo">{{ dataBloqueada.motivo }}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Mensagem quando n√£o h√° datas bloqueadas -->
          <div class="aviso" *ngIf="datasBloqueadas.length === 0">
            <div class="aviso-icon">‚úÖ</div>
            <div class="aviso-content">
              <h4>Sem Bloqueios</h4>
              <p>N√£o h√° datas bloqueadas no momento.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="admin-section">
      <h2>Clientes</h2>
      <div class="status-counters">
        <div class="counter pendente">
          <span class="counter-number">{{ contadorPendentes }}</span>
          <span class="counter-label">Pendentes</span>
        </div>
        <div class="counter confirmado">
          <span class="counter-number">{{ contadorConfirmados }}</span>
          <span class="counter-label">Confirmados</span>
        </div>
        <div class="counter concluido">
          <span class="counter-number">{{ contadorFeitos }}</span>
          <span class="counter-label">Feitos</span>
        </div>
        <div class="counter cancelado">
          <span class="counter-number">{{ contadorCancelados }}</span>
          <span class="counter-label">Cancelados</span>
        </div>
      </div>
      
      <button class="toggle-button" (click)="toggleMostrarClientes()">
        {{ mostrarClientes ? 'Ocultar Clientes' : 'Mostrar Clientes' }}
      </button>
      
      <div *ngIf="mostrarClientes" class="clientes-container">
        <div *ngIf="clientes.length === 0" class="empty-state">
          <p>Nenhum cliente cadastrado</p>
        </div>
        
        <table *ngIf="clientes.length > 0" class="clientes-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Email</th>
              <th>Telefone</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let cliente of clientes">
              <td>{{ cliente.id }}</td>
              <td>{{ cliente.nome }}</td>
              <td>{{ cliente.email }}</td>
              <td>{{ cliente.telefone }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="admin-section">
      <h2>Agendamentos</h2>
      
      <div class="filtros-container">
        <button 
          [ngClass]="{'filtro-ativo': filtroAtual === 'todos'}"
          (click)="aplicarFiltro('todos')">Todos</button>
        <button 
          [ngClass]="{'filtro-ativo': filtroAtual === 'pendentes'}"
          (click)="aplicarFiltro('pendentes')">Pendentes</button>
        <button 
          [ngClass]="{'filtro-ativo': filtroAtual === 'confirmados'}"
          (click)="aplicarFiltro('confirmados')">Confirmados</button>
        <button 
          [ngClass]="{'filtro-ativo': filtroAtual === 'feitos'}"
          (click)="aplicarFiltro('feitos')">Feitos</button>
        <button 
          [ngClass]="{'filtro-ativo': filtroAtual === 'cancelados'}"
          (click)="aplicarFiltro('cancelados')">Cancelados</button>
      </div>
      
      <div *ngIf="agendamentosFiltrados.length === 0" class="empty-state">
        <p>Nenhum agendamento encontrado</p>
      </div>
      
      <div *ngIf="agendamentosFiltrados.length > 0" class="agendamentos-list">
        <div class="agendamento-card" *ngFor="let agendamento of agendamentosFiltrados">
          <div class="agendamento-header" [ngClass]="getStatusClass(agendamento.status || '')">
            <div class="agendamento-header-left">
              <span class="agendamento-id">#{{ agendamento.id }}</span>
              <span class="agendamento-data">{{ formatarData(agendamento.data_agendada) }} - {{ formatarHora(agendamento.hora_agendada) }}</span>
            </div>
            <div class="agendamento-status">{{ getStatusLabel(agendamento.status || '') }}</div>
          </div>
          
          <div class="agendamento-body">
            <div class="agendamento-info">
              <div class="info-section cliente-info">
                <h3>Informa√ß√µes do Cliente</h3>
                <p><strong>ID:</strong> {{ agendamento.cliente_id }}</p>
                <p><strong>Nome:</strong> {{ agendamento.cliente_nome || 'Cliente #' + agendamento.cliente_id }}</p>
                <p><strong>Email:</strong> {{ agendamento.cliente_email || 'N/A' }}</p>
                <p><strong>Telefone:</strong> {{ agendamento.cliente_telefone || 'N/A' }}</p>
              </div>
              
              <div class="info-section servico-info">
                <h3>Servi√ßo Agendado</h3>
                <p><strong>ID:</strong> {{ agendamento.servico_id }}</p>
                <p><strong>Servi√ßo:</strong> {{ agendamento.servico_nome || getNomeServico(agendamento.servico_id) }}</p>
                <p><strong>Pre√ßo:</strong> R$ {{ getPrecoServico(agendamento.servico_id).toFixed(2) }}</p>
                <p><strong>Data:</strong> {{ formatarData(agendamento.data_agendada) }}</p>
                <p><strong>Hor√°rio:</strong> {{ formatarHora(agendamento.hora_agendada) }}</p>
                <p *ngIf="agendamento.observacoes"><strong>Observa√ß√µes:</strong> {{ agendamento.observacoes }}</p>
              </div>
            </div>
            
            <div class="agendamento-actions">
              <button *ngIf="agendamento.status === 'pendente'" 
                      (click)="atualizarStatus(agendamento, 'confirmado')" 
                      class="btn-confirm">
                <span class="btn-icon">‚úì</span> Confirmar
              </button>
              
              <button *ngIf="agendamento.status === 'pendente' || agendamento.status === 'confirmado'" 
                      (click)="atualizarStatus(agendamento, 'concluido')" 
                      class="btn-complete">
                <span class="btn-icon">‚úÖ</span> Feito
              </button>
              
              <button *ngIf="agendamento.status === 'confirmado'" 
                      (click)="atualizarStatus(agendamento, 'n√£o compareceu')" 
                      class="btn-no-show">
                <span class="btn-icon">‚ùå</span> Faltou
              </button>
              
              <button *ngIf="agendamento.status !== 'cancelado' && agendamento.status !== 'concluido' && agendamento.status !== 'n√£o compareceu'" 
                      (click)="atualizarStatus(agendamento, 'cancelado')" 
                      class="btn-cancel">
                <span class="btn-icon">üóëÔ∏è</span> Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>